language: go
go:
  - 1.13.4

env:
  - DOCKER_TAG_LATEST=true DOCKER_REGISTRY=test

services:
  - docker

notifications:
  email: false

jobs:
  include:
    - stage: test
      script:
        - make test
    - stage: build
      script:
        - make build
    - stage: package
      on:
        branch: master
      script:
        - make package
        - make publish
    - stage: promote
      on:
        tags: true
        branch: master
      script:
        - make promote

after_success:
  - bash <(curl -s https://codecov.io/bash)
